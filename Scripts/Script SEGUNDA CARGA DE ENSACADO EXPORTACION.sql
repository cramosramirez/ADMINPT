/*
	*************************************************************************************************
	INJIBOA1 ENSACADO
	*************************************************************************************************
*/	
-- Cambiar BODEGA DESTINO A INJIBOA Y CONCEPTO DE TRASLADO A RECONVERSION para N.R. enviadas por contenedor  *****************************************************************************
UPDATE ENTRADA_SALIDA_ENCA 
SET ID_BODEGAD = ID_BODEGAO,
	ID_CONCE = 19, ID_ESPECI = 46,
	OBSERVACION = 'EGRESO POR RECONVERSION A AZUCAR CRUDA ENSACADA, DESTINO EXPORTACION (2° ENVIO)'
WHERE ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867,96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) 

-- Ingreso reconversión de producto AZUCAR CRUDA ENSACADA ***********************************************************************************************
INSERT ENTRADA_SALIDA_ENCA
SELECT 
	ROW_NUMBER() OVER(ORDER BY E.ID_ES_ENCA) + (SELECT ISNULL(MAX(E.ID_ES_ENCA),0) FROM ENTRADA_SALIDA_ENCA E) AS ID_ES_ENCA,
	E.ID_ES_ENCA AS PARENT_ID, E.COD_CAPTURA, 
	E.FECHA, 
	ROW_NUMBER() OVER(ORDER BY E.ID_ES_ENCA) + (SELECT ISNULL(MAX(E.ID_ES_ENCA),0) FROM ENTRADA_SALIDA_ENCA E) AS NUM_DOC,
	E.NUM_DOC_PESOS, E.ES_PROPIO, E.ES_AJENO, 
	E.ID_ZAFRA_PROD, E.ID_ZAFRA_ACTUAL, 
	1 AS ID_TIPO_MOV, 20 AS ID_CONCE, 47 AS ID_ESPECI, 29 AS ID_BODEGAO, 29 AS ID_BODEGAD,
	'DBO_ADMINPT_CRUDA_ENSACADA_RECONV2' AS USUARIO_CREA, GETDATE() AS FECHA_CREA, 'DBO_ADMINPT_CRUDA_ENSACADA_RECONV2' AS USUARIO_ACT, GETDATE() AS FECHA_ACT,
	11 AS ID_ESTADO, 
	E.ID_ORDEN_TRAS,
	E.ID_PROV_TRAS,
	E.ID_TRANSPORTE,
	E.MOTORISTA,
	E.NIT,
	E.PLACA_CABEZAL, E.PLACA_REMOLQUE, E.CONTENEDOR, E.MARCHAMOS, 'INGRESO POR RECONVERSION A AZUCAR CRUDA ENSACADA, DESTINO EXPORTACION (2° ENVIO)' AS OBSERVACION, '' AS NFORMULARIO,
	E.ENCCLIENTE, E.ENCNIT, E.ENCNRC, E.ENCDEPARTAMENTO, E.ENCMUNICIPIO, E.ENCGIRO, E.ENCDIRECCION, 
	E.FECHADESPACHO,
	5 AS ID_TIPO, 29 AS ID_BODEP, E.ID_FMPAGO, E.EFECTIVO, E.CHEQUE, E.NOTAABONO, E.TOTAL, E.NCUENTA, E.NCHEQUE,
	E.BANCO, E.ID_ESTIBA, E.TENDIDO, E.FECHA_PRODUCCION, E.COLOR, E.FECHA_PRODUCCION1, 
	E.OBSERVACION_RGTRASLADO,
	E.FECHA_RGTRASLADO, E.NUM_DOC_ALMPAC, E.ID_CLIENTEEXP, E.ID_CLIENTEING, E.DONACION, E.MCHEQUE,
	E.MNOTAABONO
FROM ENTRADA_SALIDA_ENCA E
WHERE E.ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867,96842,96843,96844,96845,96903,96905,96906,96907,96908,96909)  


INSERT ENTRADA_SALIDA_DETA
SELECT 
	ROW_NUMBER() OVER(ORDER BY D.FECHA) + (SELECT ISNULL(MAX(D.ID_ES_DETA),0) FROM ENTRADA_SALIDA_DETA D) AS ID_ES_DETA,
	(SELECT E.ID_ES_ENCA FROM ENTRADA_SALIDA_ENCA E WHERE E.PARENT_ID = D.ID_ES_ENCA AND E.USUARIO_CREA = 'DBO_ADMINPT_CRUDA_ENSACADA_RECONV2') AS ID_ES_ENCA,
	D.FECHA, D.NUM_DOC, 15 AS ID_PRODUCTO, D.ID_PRESEN_TRAS, D.ID_UNIDAD_FAC, D.CANTIDAD, D.FACTOR, NEWID() AS REFERENCIA_DETA, 
	'DBO_ADMINPT_CRUDA_ENSACADA_RECONV2' AS USUARIO_CREA, GETDATE() AS FECHA_CREA, 'DBO_ADMINPT_CRUDA_ENSACADA_RECONV2' AS USUARIO_ACT, GETDATE() AS FECHA_ACT,
	D.FACTORKG, D.QUINTALES, D.KILOGRAMOS, D.GALONES, ROUND(D.KILOGRAMOS / 1000, 2) AS TM, D.TM_JIBOA, D.TM_ALMAPAC, D.TM_DIF_ALMAPAC, D.TM_DIF_JIBOA, D.FACTORTM, D.PESOKG, 29 AS ID_BODEP
FROM ENTRADA_SALIDA_DETA D
WHERE ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867,96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) 



-- Salida por exportación de producto AZUCAR CRUDA ENSACADA ***********************************************************************************************
INSERT ENTRADA_SALIDA_ENCA
SELECT 	
	ROW_NUMBER() OVER(ORDER BY FECHA) + (SELECT ISNULL(MAX(E.ID_ES_ENCA),0) FROM ENTRADA_SALIDA_ENCA E) AS ID_ES_ENCA,
	E.ID_ES_ENCA AS PARENT_ID,
	E.COD_CAPTURA,
	E.FECHA, 
	ROW_NUMBER() OVER(ORDER BY FECHA) + (SELECT ISNULL(MAX(E.ID_ES_ENCA),0) FROM ENTRADA_SALIDA_ENCA E) AS NUM_DOC,
	E.NUM_DOC_PESOS, E.ES_PROPIO, E.ES_AJENO, 
	E.ID_ZAFRA_PROD, E.ID_ZAFRA_ACTUAL, 
	2 AS ID_TIPO_MOV, 13 AS ID_CONCE, 27 AS ID_ESPECI, 29 AS ID_BODEGAO, 0 AS ID_BODEGAD,
	'DBO_ADMINPT_CRUDA_ENSACADA_EXPORT2' AS USUARIO_CREA, GETDATE() AS FECHA_CREA, 'DBO_ADMINPT_CRUDA_ENSACADA_EXPORT2' AS USUARIO_ACT, GETDATE() AS FECHA_ACT,
	4 AS ID_ESTADO, 
	NULL ID_ORDEN_TRAS,
	NULL ID_PROV_TRAS,
	NULL ID_TRANSPORTE,
	NULL MOTORISTA,
	NULL NIT,
	E.PLACA_CABEZAL, E.PLACA_REMOLQUE, E.CONTENEDOR, E.MARCHAMOS, 'EGRESO POR EXPORTACION (2° ENVIO)' AS OBSERVACION, '' AS NFORMULARIO,	
	CASE
		WHEN E.ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867) THEN 'SM.I.S. COMMODITIES LTD'
		WHEN E.ID_ES_ENCA IN(96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) THEN 'SM.I.S. COMMODITIES LTD'
	END AS ENCCLIENTE, NULL ENCNIT, NULL ENCNRC, NULL ENCDEPARTAMENTO, NULL ENCMUNICIPIO, NULL ENCGIRO, 
	'' AS ENCDIRECCION, 
	E.FECHADESPACHO,
	5 AS ID_TIPO, 29 AS ID_BODEP, E.ID_FMPAGO, E.EFECTIVO, E.CHEQUE, E.NOTAABONO, E.TOTAL, E.NCUENTA, E.NCHEQUE,
	E.BANCO, NULL ID_ESTIBA, NULL TENDIDO, NULL FECHA_PRODUCCION, NULL COLOR, E.FECHA_PRODUCCION1, 
	E.OBSERVACION_RGTRASLADO,
	E.FECHA_RGTRASLADO, E.NUM_DOC_ALMPAC, 
	CASE
		WHEN E.ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867) THEN 7
		WHEN E.ID_ES_ENCA IN(96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) THEN 7
	END AS ID_CLIENTEEXP, E.ID_CLIENTEING, E.DONACION, E.MCHEQUE,
	E.MNOTAABONO
FROM ENTRADA_SALIDA_ENCA E
WHERE E.ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867,96842,96843,96844,96845,96903,96905,96906,96907,96908,96909)

INSERT ENTRADA_SALIDA_DETA
SELECT	
	ROW_NUMBER() OVER(ORDER BY ID_ES_ENCA) + (SELECT ISNULL(MAX(D.ID_ES_DETA),0) FROM ENTRADA_SALIDA_DETA D) AS ID_ES_DETA,
	(SELECT E.ID_ES_ENCA FROM ENTRADA_SALIDA_ENCA E WHERE E.PARENT_ID = D.ID_ES_ENCA AND E.USUARIO_CREA = 'DBO_ADMINPT_CRUDA_ENSACADA_EXPORT2')  AS ID_ES_ENCA,
	NULL AS FECHA, NULL AS NUM_DOC, 15 AS ID_PRODUCTO, 2 AS ID_PRESEN_TRAS, 6 AS ID_UNIDAD_FAC, CANTIDAD, FACTOR, NEWID() AS REFERENCIA_DETA, 
	'DBO_ADMINPT_CRUDA_ENSACADA_EXPORT2' AS USUARIO_CREA, GETDATE() AS FECHA_CREA, 'DBO_ADMINPT_CRUDA_ENSACADA_EXPORT2' AS USUARIO_ACT, GETDATE() AS FECHA_ACT,
	FACTORKG, QUINTALES, KILOGRAMOS, GALONES, TM, NULL AS TM_JIBOA, NULL AS TM_ALMAPAC, NULL AS TM_DIF_ALMAPAC, NULL AS TM_DIF_JIBOA, NULL AS FACTORTM, NULL AS PESOKG, 29 AS ID_BODEP
FROM ENTRADA_SALIDA_DETA D
WHERE D.ID_ES_ENCA IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867,96842,96843,96844,96845,96903,96905,96906,96907,96908,96909)

INSERT ENTRA_SALIDA_COMP
SELECT 
	ROW_NUMBER() OVER(ORDER BY ID_ES_ENCA) + (SELECT ISNULL(MAX(D.ID_ES_COMP),0) FROM ENTRA_SALIDA_COMP D) AS ID_ES_COMP,
	E.ID_ES_ENCA,
	CASE
		WHEN E.PARENT_ID IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867) THEN '520'
		WHEN E.PARENT_ID IN(96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) THEN '521'
	END AS FAC_NUM,
	CASE
		WHEN E.PARENT_ID IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867) THEN CONVERT(DATETIME,'08/06/2023',103)
		WHEN E.PARENT_ID IN(96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) THEN CONVERT(DATETIME,'08/06/2023',103)
	END AS FAC_FECHA,
	CASE
		WHEN E.PARENT_ID IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867) THEN 'FLEUR N 334W'
		WHEN E.PARENT_ID IN(96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) THEN 'FLEUR N 334W'
	END AS VAPOR,
	CASE
		WHEN E.PARENT_ID IN(96823,96825,96827,96828,96829,96830,96832,96846,96847,96867) THEN 'SALDOO284300'
		WHEN E.PARENT_ID IN(96842,96843,96844,96845,96903,96905,96906,96907,96908,96909) THEN 'SALDOO285400'
	END AS BOOKING,
	'DBO_ADMINPT_CRUDA_ENSACADA_KARDEX2' AS USUARIO_CREA,
	GETDATE() AS FECHA_CREA
FROM ENTRADA_SALIDA_ENCA E
WHERE e.USUARIO_CREA = 'DBO_ADMINPT_CRUDA_ENSACADA_EXPORT2'

/*
	*************************************************************************************************
	FIN - INJIBOA1 ENSACADO	
*/